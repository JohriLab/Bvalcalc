


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculate B &mdash; Bvalcalc 0.6.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2d7f400b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d7a12d57"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/js/onthispage-scrollspy.js?v=33cab78c"></script>
      <script src="../_static/js/interactive-code.js?v=813d5f96"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Work in Progress…" href="../prebuilt_maps/learn.html" />
    <link rel="prev" title="SweepFinder2 with B-map" href="../guides/sweepfinder2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Bvalcalc
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/bedgff_input.html">BED/GFF Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/generate_params.html">Generate Parameters</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/site.html">Calculate Single Site B</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/gene.html">Calculate Gene B Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/region.html">Calculate Region B-map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/genome.html">Calculate Genome B-map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/bmap_utils.html">B-map Utilities for VCF</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guides/quickstart.html">Quickstart Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/params.html">Tailoring Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/multiple_dfes.html">Multiple DFEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/demography.html">Demographic Inference with B-map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/sweepfinder2.html">SweepFinder2 with B-map</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Calculate B</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About BGS and B-values</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prebuilt_maps/learn.html">Work in Progress…</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Query species B-maps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prebuilt_maps/query.html">Work in Progress…</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bvalcalc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Calculate B</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="calculate-b">
<h1>Calculate B<a class="headerlink" href="#calculate-b" title="Link to this heading"></a></h1>
<p>The Python API can be used to access core B calculation functions that take vectorized inputs. Here we show how to calculate B from linked sites (<code class="docutils literal notranslate"><span class="pre">calculateB_linear</span></code>) and unlinked sites (<code class="docutils literal notranslate"><span class="pre">calculateB_unlinked</span></code>).</p>
<section id="python-functions">
<h2>Python functions<a class="headerlink" href="#python-functions" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="Bvalcalc.get_params">
<span class="sig-prename descclassname"><span class="pre">Bvalcalc.</span></span><span class="sig-name descname"><span class="pre">get_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_dfe</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constant_dfe</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Bvalcalc/core/calculateB.html#get_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#Bvalcalc.get_params" title="Link to this definition"></a></dt>
<dd><p>Loads DFE parameters from the provided population genetic parameters file.
Caches on (params_path, gamma_dfe, constant_dfe) and rebuilds whenever
any of those three inputs change.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Bvalcalc.calculateB_linear">
<span class="sig-prename descclassname"><span class="pre">Bvalcalc.</span></span><span class="sig-name descname"><span class="pre">calculateB_linear</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distance_to_element</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length_of_element</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Bvalcalc/core/calculateB.html#calculateB_linear"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#Bvalcalc.calculateB_linear" title="Link to this definition"></a></dt>
<dd><p>Calculate B due to purifying selection acting on a linked selected element of arbitrary length, assuming a constant crossover and gene conversion rate (analytical solution).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>distance_to_element</strong> (<em>int</em>) – Distance (bp) from the neutral site to the nearest edge of the selected element.</p></li>
<li><p><strong>length_of_element</strong> (<em>int</em>) – Length (bp) of the selected element.</p></li>
<li><p><strong>params</strong> (<em>dict</em>) – Required parameters from <code class="docutils literal notranslate"><span class="pre">get_params()</span></code>, only kept as default (None) when being called by CLI,
in which case parameters are sourced from the params file directly.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Bvalcalc.calculateB_unlinked">
<span class="sig-prename descclassname"><span class="pre">Bvalcalc.</span></span><span class="sig-name descname"><span class="pre">calculateB_unlinked</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unlinked_L</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/Bvalcalc/core/calculateB.html#calculateB_unlinked"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#Bvalcalc.calculateB_unlinked" title="Link to this definition"></a></dt>
<dd><p>Calculate B due to purifying selection at unlinked sites (numerical integration over DFE).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>unlinked_L</strong> (<em>float</em>) – Cumulative count of selected sites in unlinked regions.</p></li>
<li><p><strong>params</strong> (<em>dict</em>) – Required parameters from <code class="docutils literal notranslate"><span class="pre">get_params()</span></code>, only kept as default (None) when being called by CLI,
in which case parameters are sourced from the params file directly.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">Bvalcalc</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_params</span><span class="p">,</span> <span class="n">calculateB_unlinked</span><span class="p">,</span> <span class="n">calculateB_linear</span>

<span class="c1"># Path to your Params.py file</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="s2">&quot;./DrosophilaParams.py&quot;</span><span class="p">)</span>

<span class="n">calculateB_unlinked</span><span class="p">(</span><span class="n">unlinked_L</span> <span class="o">=</span> <span class="mi">200000</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
<span class="c1"># 0.9998476570803477</span>

<span class="n">calculateB_linear</span><span class="p">(</span><span class="n">distance_to_element</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span> <span class="n">length_of_element</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
<span class="c1"># array(0.98721754)</span>
</pre></div>
</div>
<p>This will import the relevant functions, get the popgen parameters from a relevant params file, see <a class="reference internal" href="../introduction/generate_params.html"><span class="doc">Generate Parameters</span></a>.
Then B will be calculated from 200kb of unlinked sites using <code class="docutils literal notranslate"><span class="pre">calculateB_unlinked</span></code>, and B from a linked selected element of length 10kb, 500bp away is calculated using <code class="docutils literal notranslate"><span class="pre">calculateB_linear</span></code>.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Link to this heading"></a></h2>
<p>Note that <code class="docutils literal notranslate"><span class="pre">calculateB_linear</span></code> assumes a consistent crossover and gene conversion rate across both the length of and distance to the selected element, in the CLI, variable recombination rates are accounted for with
the more complex function <code class="docutils literal notranslate"><span class="pre">calculateB_recmap</span></code>; if accessing this function is important for your work feel free to raise it as an issue on GitHub as I could add it as a public API.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../guides/sweepfinder2.html" class="btn btn-neutral float-left" title="SweepFinder2 with B-map" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../prebuilt_maps/learn.html" class="btn btn-neutral float-right" title="Work in Progress…" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Jacob Marsh, Parul Johri.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
   
  <!-- To bottom button -->
  <div class="scroll-bottom-wrapper">
    <button class="scroll-to-bottom-btn" aria-label="Scroll to bottom">
      <span class="scroll-to-bottom-btn-text">↓ ↓ ↓</span>
    </button>
  </div>
  <!-- Right elements -->
  <div class="right-elements-container">
    <div class="on-this-page">
        <ul>
<li><a class="reference internal" href="#">Calculate B</a><ul>
<li><a class="reference internal" href="#python-functions">Python functions</a><ul>
<li><a class="reference internal" href="#Bvalcalc.get_params"><code class="docutils literal notranslate"><span class="pre">get_params()</span></code></a></li>
<li><a class="reference internal" href="#Bvalcalc.calculateB_linear"><code class="docutils literal notranslate"><span class="pre">calculateB_linear()</span></code></a></li>
<li><a class="reference internal" href="#Bvalcalc.calculateB_unlinked"><code class="docutils literal notranslate"><span class="pre">calculateB_unlinked()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>

    </div>
    <img src="../_static/Bvalcalc_bee_trail.svg" aria-hidden="true" class="bee-trail-img" />
    <div class="bottom-right-elements">
      <div class="citation-text">
        <strong>Citation:</strong><br/>Marsh, JI, Johri, PJ (2025).
        <span class="citation-body">
          The B-value calculator: efficient analytical calculation of expected
          genetic diversity with background selection. <i>bioRxiv</i>. 
        </span>
        <a href="https://biorxiv" target="_blank" rel="noopener noreferrer">10.1101/2063.10.10.561727</a>
      </div>      
      <div class="made-by-sphinx-text">
        Made with <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener noreferrer">Sphinx</a>
        using an adapted <a href="https://github.com/rtfd/sphinx_rtd_theme" target="_blank" rel="noopener noreferrer">theme</a> 
        from <a href="https://readthedocs.org/" target="_blank" rel="noopener noreferrer">Read the Docs</a> <br/>
      </div>
      <div class="links-text">
        <a href="https://test.pypi.org/project/Bvalcalc/" target="_blank" rel="noopener noreferrer">PyPI</a> | 
        <a href="https://github.com/JohriLab/Bvalcalc/issues" target="_blank" rel="noopener noreferrer">Report a bug</a> | 
        <a href="https://github.com/JohriLab/Bvalcalc" target="_blank" rel="noopener noreferrer">Source code</a> 
      </div>
    </div>  
  </div>


</body>
</html>